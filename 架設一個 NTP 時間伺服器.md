好的，沒有問題。在 Windows 10 上使用內建的「Windows Time」服務 (w32time) 來架設一個 NTP 時間伺服器是完全可行的，特別適合用於小型的區域網路、實驗室環境，或讓沒有連上網際網路的裝置有一個統一的時間基準。

以下將為您提供詳細的設定步驟、如何使用以及相關的驗證方法。

### 前置準備

1.  **系統管理員權限：** 所有操作都需要使用「系統管理員」身分來執行。
2.  **固定 IP 位址：** 作為伺服器，建議將這台 Windows 10 電腦的 IP 位址設定為固定的靜態 IP，這樣用戶端裝置才能穩定地找到它。
3.  **確認 Windows Time 服務：** 確保 Windows Time 服務正在執行。您可以按下 `Win + R` 輸入 `services.msc`，找到 `Windows Time` 服務，確認其狀態為「執行中」，並建議將「啟動類型」設定為「自動」。

-----

### 設定步驟：將您的 Windows 10 變成 NTP 伺服器

我們將透過修改登錄檔 (Registry) 來啟用 NTP 伺服器功能。這是最直接且根本的方法。

**步驟 1：以系統管理員身分開啟「命令提示字元」或「PowerShell」**

  * 在開始功能表按右鍵，選擇「Windows PowerShell (系統管理員)」或「命令提示字元 (系統管理員)」。

**步驟 2：執行指令啟用 NTP 伺服器**

請依序複製並執行以下兩條指令。

1.  **啟用 NTP 伺服器功能：**
    這條指令會修改登錄檔，將 NTP 伺服器功能從「停用」改為「啟用」。

    ```powershell
    reg add "HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpServer" /v Enabled /t REG_DWORD /d 1 /f
    ```

2.  **宣告為可靠的時間來源：**
    這條指令是關鍵。它會修改 `AnnounceFlags` 這個設定，讓您的電腦向網路中的其他裝置宣告「我是一個可靠的時間伺服器」。數值 `5` 代表它會穩定地作為時間來源。

    ```powershell
    reg add "HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config" /v AnnounceFlags /t REG_DWORD /d 5 /f
    ```

**步驟 3：重新啟動 Windows Time 服務**

為了讓剛剛所有的設定變更立即生效，必須重新啟動 Windows Time 服務。

```powershell
net stop w32time
net start w32time
```

到這裡，您的 Windows 10 理論上已經具備 NTP 伺服器的功能了。但還有一個非常重要的步驟。

-----

### 防火牆設定：允許 NTP 連線

NTP 服務使用 **UDP 通訊埠 123** 進行通訊。Windows 預設的防火牆會阻擋外部裝置連入這個通訊埠，所以我們必須手動新增一條「輸入規則」。

1.  按下 `Win + R`，輸入 `wf.msc` 並按 Enter，開啟「具有進階安全性的 Windows Defender 防火牆」。
2.  在左側窗格點選「輸入規則」。
3.  在右側窗格點選「新增規則...」。
4.  **規則類型：** 選擇「連接埠」，然後按「下一步」。
5.  **通訊協定及連接埠：**
      * 選擇「UDP」。
      * 選擇「特定本機連接埠」，並在欄位中輸入 `123`。
      * 按「下一步」。
6.  **動作：** 選擇「允許連線」，然後按「下一步」。
7.  **設定檔：** 根據您的網路環境勾選。如果您是在家裡或公司的內部網路，通常勾選「私人」和「網域」即可。為了確保萬無一失，可以三個都勾選。按「下一步」。
8.  **名稱：** 為這個規則取一個容易辨識的名稱，例如 `NTP Server (UDP 123 In)`，然後按「完成」。

至此，您的 Windows 10 NTP 伺服器已完全設定完成並準備好提供服務。

-----

### 如何驗證與使用您的 NTP 伺服器

#### 1\. 驗證伺服器設定

在您的 Windows 10 伺服器上，再次開啟系統管理員權限的命令提示字元，執行以下指令來確認設定是否成功。

```powershell
w32tm /query /configuration
```

在顯示的長篇設定中，檢查以下幾個關鍵項目：

  * 在 `[TimeProviders]` 區段下，確認 `NtpServer` 的 `Enabled` 數值為 `1`。
  * 在 `[Config]` 區段下，確認 `AnnounceFlags` 數值為 `5`。

如果都正確，代表您的伺服器已經設定成功。

#### 2\. 取得伺服器 IP 位址

用戶端裝置需要知道您這台 Win10 伺服器的 IP 位址才能連線。

  * 在您的 Win10 伺服器上，開啟命令提示字元，輸入 `ipconfig`。
  * 找到您正在使用的網路連線 (例如「乙太網路卡」或「無線區域網路介面卡」)，記下其 `IPv4 位址`。例如：`192.168.1.100`。

#### 3\. 設定用戶端裝置 (如何使用)

現在，讓網路上其他電腦或裝置來使用您架設好的時間伺服器。

**對於另一台 Windows 電腦：**

1.  在用戶端電腦上，到「設定」\>「時間與語言」\>「日期與時間」。
2.  點擊「其他設定」下方的「立即同步處理」。(這會先跟微軟預設的伺服器同步)
3.  回到「設定」\>「時間與語言」，點擊右側的「新增不同時區的時鐘」。
4.  在跳出的視窗中，切換到「網際網路時間」標籤頁，點擊「變更設定」。
5.  勾選「與網際網路時間伺服器同步處理」。
6.  在「伺服器(E):」的欄位中，**輸入您 Win10 NTP 伺服器的 IP 位址** (例如: `192.168.1.100`)。
7.  點擊「立即更新」，如果顯示「時鐘在...與...成功同步」，就表示成功了！
8.  點擊「確定」儲存設定。

**對於其他裝置 (如 Linux、路由器、網路攝影機等)：**

  * 進入該裝置的時間或網路設定頁面，找到 NTP 或時間伺服器設定欄位。
  * 將伺服器位址手動指向您 Windows 10 電腦的 IP 位址即可。

### 重要提醒

  * **準確性來源：** 依照上述設定，您的 Win10 伺服器會以自己的系統時鐘作為時間基準。若要讓它更準確，您可以讓這台 Win10 電腦自己去跟更權威的外部時間伺服器 (如 `tock.stdtime.gov.tw`) 同步，然後再將這個準確的時間分享給內部網路。這可以在「網際網路時間」設定中完成。
  * **電腦開機：** 作為伺服器的這台 Windows 10 電腦必須保持開機狀態，其他裝置才能向它同步時間。
